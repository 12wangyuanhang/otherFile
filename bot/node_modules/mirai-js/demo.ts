import { Bot, Middleware } from './src';

(async () => {
    try {
        const baseUrl = 'http://1.117.228.194:8080';
        const verifyKey = '123456';
        const qq = 1019933576;
        const bot = new Bot();

        // 在 mirai-console 登录你的 bot

        // 创建一个会话
        await bot.open({
            // mirai-api-http 的服务端地址，
            baseUrl,
            // 要绑定的 qq，须确保该用户已在 mirai-console 登录
            qq,
            // verifyKey 用于验证连接者的身份，在插件配置文件中设置
            verifyKey,
        });

        // 监听好友消息事件
        // bot.on('GroupMessage', new Middleware().groupFilter([795621075]).messageIdProcessor().done(async ({

        //     sender: {
        //         id: fromQQ,
        //         nickname: fromQQNickName,
        //         remark,
        //         group: { id: target }
        //     },
        //     messageId
        // }) => {
        //     console.log({ fromQQ, fromQQNickName, remark });
        //     bot.setEssence({ messageId, target });
        // }));
        bot.on('GroupRecallEvent', async ctx => {
            const msg = await bot.getMessageById({ messageId: ctx.messageId, target: ctx.group.id });
            // repeat the msg recalled just now
            console.log(msg);
            bot.sendMessage({ group: msg.sender.group?.id, message: msg.messageChain, }); //error
        });

    } catch (err) {
        console.log(err);
    }
})();
